<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USART模块详情 - STM32F103</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background-color: #0a0a0a;
            color: #f0f0f0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* 头部样式 */
        header {
            padding: 30px 0 20px;
            border-bottom: 1px solid #333;
            margin-bottom: 40px;
        }
        
        /* 标题区域 - 改为左对齐 */
        h1 {
            color: #fff;
            font-size: 2.8rem;
            margin-bottom: 5px;
            letter-spacing: 1px;
            text-align: left;
        }
        
        /* 副标题与按钮容器 - 调整布局 */
        .subtitle-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .module-subtitle {
            color: #aaa;
            font-size: 1.2rem;
            line-height: 1.6;
            text-align: left;
            flex: 1;
            min-width: 300px;
            margin-bottom: 15px;
        }
        
        /* 面包屑导航 - 改为左对齐 */
        .breadcrumb {
            text-align: left;
            margin-bottom: 20px;
            color: #888;
            font-size: 0.95rem;
        }
        
        .breadcrumb a {
            color: #aaa;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .breadcrumb a:hover {
            color: #fff;
            text-decoration: underline;
        }
        
        /* 按钮容器 - 移到右侧 */
        .header-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }
        
        /* 导航按钮样式 */
        .nav-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background-color: #222;
            color: #fff;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            border: 1px solid #444;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .nav-button:hover {
            background-color: #333;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .nav-button.cubemx {
            border-left: 4px solid #ff9800;
        }
        
        .nav-button.hal {
            border-left: 4px solid #4ec9b0;
        }
        
        .nav-button.details {
            border-left: 4px solid #569cd6;
        }
        
        /* 主要内容布局 - 保持左主右辅 */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 40px;
            margin-bottom: 60px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.8s ease forwards;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* 左侧内容区域 */
        .content-left {
            background-color: #111;
            border-radius: 15px;
            padding: 40px;
            border: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        /* 右侧侧边栏 - 模块详情 */
        .sidebar-right {
            background-color: #111;
            border-radius: 15px;
            padding: 30px;
            border: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transform: translateX(30px);
            animation: slideInRight 1s ease 0.3s forwards;
        }
        
        @keyframes slideInRight {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* 内容区域样式 */
        .content-section {
            margin-bottom: 40px;
        }
        
        .content-section h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #fff;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .content-section h3 {
            font-size: 1.4rem;
            margin: 25px 0 15px;
            color: #ddd;
        }
        
        .content-section p {
            color: #bbb;
            line-height: 1.7;
            margin-bottom: 15px;
        }
        
        .content-section ul, .content-section ol {
            padding-left: 25px;
            margin-bottom: 20px;
        }
        
        .content-section li {
            color: #bbb;
            line-height: 1.7;
            margin-bottom: 8px;
        }
        
        /* 代码块样式 */
        .code-block {
            background-color: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #666;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        
        .code-block pre {
            color: #ddd;
            line-height: 1.5;
            white-space: pre-wrap;
        }
        
        .code-block code {
            color: #4ec9b0;
        }
        
        /* 配置选项表格 */
        .config-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: #1a1a1a;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .config-table th {
            background-color: #222;
            color: #fff;
            text-align: left;
            padding: 12px 15px;
            font-weight: 600;
            border-bottom: 2px solid #333;
        }
        
        .config-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #333;
            color: #bbb;
        }
        
        .config-table tr:nth-child(even) {
            background-color: #1a1a1a;
        }
        
        .config-table tr:hover {
            background-color: #222;
        }
        
        /* 侧边栏样式 - 模块详情 */
        .sidebar-section {
            margin-bottom: 30px;
        }
        
        .sidebar-section h3 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #fff;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* 技术参数表格 */
        .params-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .params-table th {
            background-color: #222;
            color: #fff;
            text-align: left;
            padding: 12px 15px;
            font-weight: 600;
            border-bottom: 2px solid #333;
        }
        
        .params-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #333;
            color: #bbb;
        }
        
        .params-table tr:nth-child(even) {
            background-color: #1a1a1a;
        }
        
        .params-table tr:hover {
            background-color: #222;
        }
        
        /* 寄存器列表 */
        .register-list {
            list-style: none;
            padding: 0;
        }
        
        .register-list li {
            padding: 10px 15px;
            margin-bottom: 8px;
            background-color: #1a1a1a;
            border-radius: 6px;
            border-left: 3px solid #666;
            transition: all 0.3s ease;
        }
        
        .register-list li:hover {
            background-color: #222;
            border-left-color: #aaa;
            transform: translateX(5px);
        }
        
        .register-name {
            font-weight: bold;
            color: #fff;
            display: block;
            margin-bottom: 5px;
        }
        
        .register-desc {
            color: #aaa;
            font-size: 0.9rem;
        }
        
        /* 功能标签 */
        .pin-functions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .pin-tag {
            background-color: #1a1a1a;
            color: #ccc;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid #333;
            transition: all 0.3s ease;
        }
        
        .pin-tag:hover {
            background-color: #222;
            border-color: #666;
            transform: translateY(-3px);
        }
        
        /* 模块特性卡片 */
        .module-features {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feature-card {
            background-color: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            border-top: 4px solid #666;
            transition: transform 0.3s ease, border-color 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            border-color: #aaa;
        }
        
        .feature-card h4 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .feature-card p {
            color: #bbb;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* 返回按钮 */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background-color: #222;
            color: #fff;
            text-decoration: none;
            padding: 12px 25px;
            border-radius: 8px;
            margin-top: 20px;
            transition: all 0.3s ease;
            border: 1px solid #444;
        }
        
        .back-button:hover {
            background-color: #333;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* 页脚 */
        footer {
            text-align: center;
            padding: 40px 0;
            margin-top: 60px;
            border-top: 1px solid #333;
            color: #888;
            font-size: 0.9rem;
        }
        
        /* 响应式设计 */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr 300px;
            }
            
            .content-left {
                padding: 30px;
            }
            
            .sidebar-right {
                padding: 25px;
            }
        }
        
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .sidebar-right {
                order: -1;
            }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .module-subtitle {
                font-size: 1rem;
                min-width: 100%;
            }
            
            .content-left, .sidebar-right {
                padding: 25px;
            }
            
            .module-features {
                grid-template-columns: 1fr;
            }
            
            .params-table, .config-table {
                font-size: 0.9rem;
            }
            
            .params-table th, .params-table td,
            .config-table th, .config-table td {
                padding: 10px 12px;
            }
            
            .subtitle-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .module-subtitle {
                text-align: left;
                width: 100%;
                order: 1;
            }
            
            .header-buttons {
                width: 100%;
                justify-content: flex-start;
                order: 2;
            }
            
            .breadcrumb {
                text-align: left;
            }
        }
        
        @media (max-width: 576px) {
            .content-left, .sidebar-right {
                padding: 20px;
            }
            
            .content-section h2 {
                font-size: 1.6rem;
            }
            
            .content-section h3 {
                font-size: 1.3rem;
            }
            
            .sidebar-section h3 {
                font-size: 1.3rem;
            }
            
            .header-buttons {
                flex-direction: column;
                width: 100%;
            }
            
            .nav-button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="breadcrumb">
                <a href="demo.html">主页</a> &gt; <span>USART模块详情</span>
            </div>
            
            <h1>USART（通用同步异步收发器）</h1>
            
            <!-- 副标题与按钮容器 -->
            <div class="subtitle-container">
                <!-- 副标题 - 左侧 -->
                <p class="module-subtitle">STM32F103的USART是最常用的通信接口之一，<br>用于设备间的串行数据交换。支持异步通信和同步通信，可配置多种工作模式和参数，适用于各种串行通信场景。</p>
                
                <!-- 按钮容器 - 右侧 -->
                <div class="header-buttons">
                    <button class="nav-button cubemx" onclick="scrollToSection('cubemx-quickstart')">
                        <i class="fas fa-tools"></i> CubeMX使用
                    </button>
                    <button class="nav-button hal" onclick="scrollToSection('hal-library')">
                        <i class="fas fa-code"></i> HAL库使用
                    </button>
                    <button class="nav-button details" onclick="scrollToSection('details')">
                        <i class="fas fa-info-circle"></i> 详细信息
                    </button>
                </div>
            </div>
        </header>
        
        <main>
            <div class="main-content">
                <!-- 左侧内容区域 -->
                <div class="content-left">
                    <div class="content-section">
                        <h2><i class="fas fa-info-circle"></i> 概述</h2>
                        <p>USART（Universal Synchronous/Asynchronous Receiver/Transmitter）是STM32F103中最常用的通信接口之一，用于设备间的串行数据交换。该模块支持全双工异步通信和半双工同步通信，具有高度可配置性，能够满足多种应用场景的需求。</p>
                        
                        <h3>主要功能与特性</h3>
                        <p>USART模块的主要功能和特性：</p>
                        
                        <ul>
                            <li><strong>全双工异步通信</strong>：支持同时发送和接收数据，无需时钟线</li>
                            <li><strong>可配置波特率</strong>：支持分数波特率生成器，提高通信精度</li>
                            <li><strong>多种数据帧格式</strong>：可配置数据位（8或9位）、停止位（1、1.5或2位）、校验位（奇偶校验）</li>
                            <li><strong>硬件流控制</strong>：支持CTS/RTS硬件流控制，防止数据丢失</li>
                            <li><strong>多工作模式</strong>：支持LIN模式、智能卡模式、IrDA红外模式等</li>
                            <li><strong>DMA支持</strong>：可与DMA控制器配合，减少CPU开销</li>
                        </ul>
                    </div>
                    
                    <!-- CubeMX使用部分 -->
                    <div id="cubemx-quickstart" class="content-section">
                        <h2><i class="fas fa-tools"></i> CubeMX使用</h2>
                        <p>STM32CubeMX是ST官方提供的图形化配置工具，可以快速配置USART参数，生成初始化代码。</p>
                        
                        <h3>USART基础配置步骤</h3>
                        <p>在STM32CubeMX中配置USART的基本流程：</p>
                        <ol>
                            <li><strong>工程与芯片创建</strong>：新建工程，选择STM32F103C8T6等具体型号</li>
                            <li><strong>开启并配置USART</strong>：
                                <ul>
                                    <li>在Connectivity下选择USART1（或其他USART实例）</li>
                                    <li>将Mode设为Asynchronous（异步模式）</li>
                                    <li>在Parameter Settings中设置波特率（常用115200）、数据位（常用8位）、校验位（常用None）、停止位（常用1位）</li>
                                </ul>
                            </li>
                            <li><strong>GPIO设置</strong>：自动配置为PA9（TX）和PA10（RX）。如需更换引脚，可在芯片引脚图上查找USART的复用功能引脚</li>
                            <li><strong>配置系统与时钟</strong>：
                                <ul>
                                    <li>在SYS中可选Debug模式（如Serial Wire）</li>
                                    <li>在RCC中选择高速外部时钟（HSE），通常将系统时钟树配置为72MHz</li>
                                </ul>
                            </li>
                            <li><strong>生成代码</strong>：在Project Manager中设置好项目名和路径，选择开发工具（如MDK-ARM V5或STM32CubeIDE），最后生成代码</li>
                        </ol>
                        
                        <h3>三种通信模式与配置要点</h3>
                        <p>生成基础代码后，需要根据应用需求选择并配置合适的通信模式：</p>
                        
                        <table class="config-table">
                            <thead>
                                <tr>
                                    <th>特性/模式</th>
                                    <th>轮询模式</th>
                                    <th>中断模式</th>
                                    <th>DMA模式</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>工作原理</td>
                                    <td>CPU不断查询状态标志</td>
                                    <td>数据收发完成后触发中断，CPU处理</td>
                                    <td>由DMA控制器搬运数据，不占用CPU</td>
                                </tr>
                                <tr>
                                    <td>CPU占用</td>
                                    <td>高（在发送/接收期间阻塞）</td>
                                    <td>中（仅中断处理时占用）</td>
                                    <td>低（仅在开始和结束时介入）</td>
                                </tr>
                                <tr>
                                    <td>实时性</td>
                                    <td>差</td>
                                    <td>好</td>
                                    <td>好</td>
                                </tr>
                                <tr>
                                    <td>适用场景</td>
                                    <td>简单、低速、非实时任务</td>
                                    <td>需要及时响应的数据收发</td>
                                    <td>大数据量、高速、低功耗应用</td>
                                </tr>
                                <tr>
                                    <td>关键配置</td>
                                    <td>无需额外配置</td>
                                    <td>在NVIC Settings中使能对应USART的全局中断</td>
                                    <td>在DMA Settings中添加TX/RX通道，并设置优先级（Priority）、模式（Mode）和内存地址自增（Increment Address）</td>
                                </tr>
                                <tr>
                                    <td>主要函数</td>
                                    <td>HAL_UART_Transmit()<br>HAL_UART_Receive()</td>
                                    <td>HAL_UART_Transmit_IT()<br>HAL_UART_Receive_IT()</td>
                                    <td>HAL_UART_Transmit_DMA()<br>HAL_UART_Receive_DMA()</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="code-block">
                            <pre><code>// 注意：DMA模式分为Normal（单次传输）和Circular（循环传输）两种模式
// 在工程中，使用printf输出调试信息通常需要重定向fputc函数到USART的发送函数</code></pre>
                        </div>
                        
                        <h3>应用示例：串口命令控制</h3>
                        <p>以一个简单示例来说明：STM32以中断方式接收上位机命令（#暂停、*恢复发送），然后控制数据发送。</p>
                        
                        <p><strong>基本思路：</strong>在主程序初始化后启动中断接收。当接收到字符时，自动进入回调函数判断命令，修改发送使能标志位。主循环根据此标志决定是否发送数据。</p>
                        
                        <p><strong>关键代码：</strong></p>
                        
                        <div class="code-block">
                            <pre><code>// 初始化后启动接收中断
// 在main()函数初始化部分添加
HAL_UART_Receive_IT(&huart1, &rx_data, 1);

// 编写中断回调函数
// 在main.c的用户代码区添加HAL_UART_RxCpltCallback()函数
void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart) {
    if (huart->Instance == USART1) {
        // 判断接收到的字符
        if (rx_data == '#') {
            send_enabled = 0; // 暂停发送
        } else if (rx_data == '*') {
            send_enabled = 1; // 恢复发送
        }
        
        // 重新启动接收，等待下一个字符
        HAL_UART_Receive_IT(&huart1, &rx_data, 1);
    }
}

// 主循环控制发送
// 在while(1)循环中，根据标志位状态调用发送函数
while (1) {
    if (send_enabled) {
        // 发送数据
        HAL_UART_Transmit(&huart1, tx_buffer, sizeof(tx_buffer), HAL_MAX_DELAY);
        HAL_Delay(1000); // 每秒发送一次
    }
    // 其他任务...
}</code></pre>
                        </div>
                        
                        <h3>调试与注意事项</h3>
                        <ul>
                            <li><strong>硬件连接</strong>：使用USB转TTL模块连接时，务必保证MCU的TX接模块的RX，MCU的RX接模块的TX，且共地</li>
                            <li><strong>引脚复用</strong>：若默认引脚被占用，可查阅数据手册，在CubeMX中将USART功能映射到其他复用引脚上（如USART1也可映射到PB6/PB7）</li>
                            <li><strong>通信参数</strong>：确保单片机与上位机串口助手的波特率、数据位、停止位、校验位设置完全一致，否则会出现乱码</li>
                        </ul>
                    </div>
                        
                    <!-- HAL库使用部分 -->
                    <div id="hal-library" class="content-section">
                        <h2><i class="fas fa-code"></i> HAL库使用</h2>
                        <p>STM32 HAL库为USART提供了简洁易用的操作接口，以下是如何使用HAL库配置和操作USART的详细说明。</p>
                        
                        <h3>HAL主要函数列表</h3>
                        <div class="code-block">
                            <pre><code>// USART HAL主要函数
HAL_UART_Init()           // 初始化USART
HAL_UART_DeInit()         // 反初始化USART
HAL_UART_Transmit()       // 轮询模式发送数据
HAL_UART_Receive()        // 轮询模式接收数据
HAL_UART_Transmit_IT()    // 中断模式发送数据
HAL_UART_Receive_IT()     // 中断模式接收数据
HAL_UART_Transmit_DMA()   // DMA模式发送数据
HAL_UART_Receive_DMA()    // DMA模式接收数据
HAL_UART_IRQHandler()     // USART中断处理函数
HAL_UART_TxCpltCallback() // 发送完成回调函数
HAL_UART_RxCpltCallback() // 接收完成回调函数</code></pre>
                        </div>
                        
                        <h3>常用HAL函数使用示例</h3>
                        <p>USART基本操作函数：</p>
                        
                        <div class="code-block">
                            <pre><code>// 常用HAL函数使用示例
#include "stm32f1xx_hal.h"

// 轮询模式发送数据
void UART_Send_Data(uint8_t *data, uint16_t size) {
    // 阻塞式发送，直到发送完成或超时
    HAL_UART_Transmit(&huart1, data, size, HAL_MAX_DELAY);
}

// 轮询模式接收数据
void UART_Receive_Data(uint8_t *buffer, uint16_t size) {
    // 阻塞式接收，直到接收完成或超时
    HAL_UART_Receive(&huart1, buffer, size, HAL_MAX_DELAY);
}

// 中断模式发送数据
void UART_Send_IT(uint8_t *data, uint16_t size) {
    // 非阻塞发送，发送完成后触发中断
    HAL_UART_Transmit_IT(&huart1, data, size);
}

// 中断模式接收数据
void UART_Receive_IT(uint8_t *buffer, uint16_t size) {
    // 非阻塞接收，接收完成后触发中断
    HAL_UART_Receive_IT(&huart1, buffer, size);
}</code></pre>
                        </div>
                        
                        <h3>USART初始化配置</h3>
                        <p>USART配置通过<code>UART_InitTypeDef</code>结构体完成：</p>
                        
                        <div class="code-block">
                            <pre><code>// UART_InitTypeDef 结构体定义
UART_HandleTypeDef huart1;

huart1.Instance = USART1;
huart1.Init.BaudRate = 115200;          // 波特率
huart1.Init.WordLength = UART_WORDLENGTH_8B;  // 数据位长度：8位
huart1.Init.StopBits = UART_STOPBITS_1; // 停止位：1位
huart1.Init.Parity = UART_PARITY_NONE;  // 校验位：无
huart1.Init.Mode = UART_MODE_TX_RX;     // 模式：发送和接收
huart1.Init.HwFlowCtl = UART_HWCONTROL_NONE; // 硬件流控制：无
huart1.Init.OverSampling = UART_OVERSAMPLING_16; // 过采样：16倍

// 初始化USART
if (HAL_UART_Init(&huart1) != HAL_OK) {
    Error_Handler();
}</code></pre>
                        </div>
                        
                        <h3>HAL库USART初始化完整示例</h3>
                        <p>使用HAL库初始化USART的完整示例：</p>
                        
                        <div class="code-block">
                            <pre><code>// HAL库USART初始化完整示例
#include "stm32f1xx_hal.h"

UART_HandleTypeDef huart1;

void MX_USART1_UART_Init(void) {
    // 1. 使能USART1时钟
    __HAL_RCC_USART1_CLK_ENABLE();
    
    // 2. 配置GPIO引脚
    GPIO_InitTypeDef GPIO_InitStruct = {0};
    GPIO_InitStruct.Pin = GPIO_PIN_9;        // TX引脚
    GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;  // 复用推挽输出
    GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_HIGH;
    HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);
    
    GPIO_InitStruct.Pin = GPIO_PIN_10;       // RX引脚
    GPIO_InitStruct.Mode = GPIO_MODE_INPUT;  // 输入模式
    GPIO_InitStruct.Pull = GPIO_NOPULL;
    HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);
    
    // 3. 配置USART参数
    huart1.Instance = USART1;
    huart1.Init.BaudRate = 115200;
    huart1.Init.WordLength = UART_WORDLENGTH_8B;
    huart1.Init.StopBits = UART_STOPBITS_1;
    huart1.Init.Parity = UART_PARITY_NONE;
    huart1.Init.Mode = UART_MODE_TX_RX;
    huart1.Init.HwFlowCtl = UART_HWCONTROL_NONE;
    huart1.Init.OverSampling = UART_OVERSAMPLING_16;
    
    // 4. 初始化USART
    if (HAL_UART_Init(&huart1) != HAL_OK) {
        Error_Handler();
    }
    
    // 5. 配置USART中断
    HAL_NVIC_SetPriority(USART1_IRQn, 0, 0);
    HAL_NVIC_EnableIRQ(USART1_IRQn);
}</code></pre>
                        </div>
                        
                        <h3>USART中断配置示例</h3>
                        <p>配置USART中断的完整示例：</p>
                        
                        <div class="code-block">
                            <pre><code>// USART中断配置示例
#include "stm32f1xx_hal.h"

UART_HandleTypeDef huart1;
uint8_t rx_buffer[100];
uint8_t tx_buffer[100];

// USART初始化
void USART_Interrupt_Init(void) {
    // 配置USART参数，启用中断
    huart1.Instance = USART1;
    huart1.Init.BaudRate = 115200;
    huart1.Init.WordLength = UART_WORDLENGTH_8B;
    huart1.Init.StopBits = UART_STOPBITS_1;
    huart1.Init.Parity = UART_PARITY_NONE;
    huart1.Init.Mode = UART_MODE_TX_RX;
    
    // 初始化USART
    HAL_UART_Init(&huart1);
    
    // 配置中断优先级
    HAL_NVIC_SetPriority(USART1_IRQn, 1, 0);
    HAL_NVIC_EnableIRQ(USART1_IRQn);
    
    // 启动接收中断
    HAL_UART_Receive_IT(&huart1, rx_buffer, 1);
}

// 在stm32f1xx_it.c中调用中断处理函数
void USART1_IRQHandler(void) {
    HAL_UART_IRQHandler(&huart1);
}

// 实现接收完成回调函数
void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart) {
    if (huart->Instance == USART1) {
        // 处理接收到的数据
        // 例如：将接收到的数据回传
        HAL_UART_Transmit_IT(&huart1, rx_buffer, 1);
        
        // 重新启动接收，等待下一个字节
        HAL_UART_Receive_IT(&huart1, rx_buffer, 1);
    }
}</code></pre>
                        </div>
                    </div>
                    
                    <div class="content-section">
                        <h2><i class="fas fa-cogs"></i> 配置与使用</h2>
                        <p>USART的正确配置是确保通信稳定可靠的基础。以下是USART配置的详细步骤和最佳实践。</p>
                        
                        <h3>USART配置步骤</h3>
                        <ol>
                            <li><strong>时钟使能</strong>：通过RCC寄存器使能对应USART的时钟</li>
                            <li><strong>引脚配置</strong>：配置TX和RX引脚的GPIO模式（TX为复用推挽输出，RX为输入）</li>
                            <li><strong>参数设置</strong>：根据应用需求设置波特率、数据位、停止位、校验位等</li>
                            <li><strong>中断配置</strong>：如需中断功能，配置NVIC优先级和中断使能</li>
                            <li><strong>初始化完成</strong>：调用HAL_UART_Init()函数应用配置</li>
                            <li><strong>启动通信</strong>：根据需求选择轮询、中断或DMA模式启动发送/接收</li>
                        </ol>
                        
                        <h3>printf重定向到USART</h3>
                        <p>将printf函数重定向到USART，方便调试输出：</p>
                        
                        <div class="code-block">
                            <pre><code>// 重定向printf到USART1
#ifdef __GNUC__
    #define PUTCHAR_PROTOTYPE int __io_putchar(int ch)
#else
    #define PUTCHAR_PROTOTYPE int fputc(int ch, FILE *f)
#endif

PUTCHAR_PROTOTYPE {
    // 将字符发送到USART1
    HAL_UART_Transmit(&huart1, (uint8_t *)&ch, 1, HAL_MAX_DELAY);
    return ch;
}

// 使用示例
#include <stdio.h>

int main(void) {
    // 初始化USART...
    MX_USART1_UART_Init();
    
    // 使用printf输出调试信息
    printf("System initialized successfully!\r\n");
    printf("Baud rate: %d\r\n", 115200);
    
    while (1) {
        // 主循环
    }
}</code></pre>
                        </div>
                    </div>
                    
                    <!-- 详细信息部分 -->
                    <div id="details" class="content-section">
                        <h2><i class="fas fa-file-alt"></i> 详细信息</h2>
                        <p>深入了解USART的内部架构、性能特性和高级功能。</p>
                        
                        <h3>USART架构设计</h3>
                        <p>USART模块采用高度灵活的架构设计：</p>
                        <ul>
                            <li><strong>发送移位寄存器</strong>：将并行数据转换为串行数据发送</li>
                            <li><strong>接收移位寄存器</strong>：将串行数据转换为并行数据接收</li>
                            <li><strong>波特率生成器</strong>：生成精确的通信时钟，支持分数分频</li>
                            <li><strong>数据缓冲区</strong>：USART_DR寄存器作为数据发送/接收缓冲区</li>
                            <li><strong>状态寄存器和中断控制器</strong>：管理USART状态和中断事件</li>
                        </ul>
                        
                        <h3>性能分析与优化</h3>
                        <p>USART模块性能关键指标和优化建议：</p>
                        <ul>
                            <li><strong>最大波特率</strong>：在72MHz系统时钟下，最高可达4.5Mbps</li>
                            <li><strong>数据吞吐量</strong>：使用DMA传输可大幅提高吞吐量</li>
                            <li><strong>功耗优化</strong>：合理使用低功耗模式和时钟门控</li>
                            <li><strong>抗干扰能力</strong>：合理配置校验位和硬件流控制</li>
                            <li><strong>误差控制</strong>：分数波特率生成器可将波特率误差控制在0.1%以内</li>
                        </ul>
                        
                        <h3>不同产品系列的USART差异</h3>
                        <div class="code-block">
                            <pre><code>// 不同STM32系列的USART差异
#if defined(STM32F103xE) || defined(STM32F103xG)
    // 大容量产品：支持3个USART（USART1, USART2, USART3）
    // 支持所有高级功能：LIN模式、智能卡模式、IrDA模式等
    #define USART_FULL_FEATURES
#elif defined(STM32F103xC)
    // 中容量产品：支持2-3个USART
    // 支持基本功能，部分高级功能可能受限
    #define USART_STANDARD_FEATURES
#elif defined(STM32F103x8) || defined(STM32F103xB)
    // 小容量产品：支持1-2个USART
    // 仅支持基本异步通信功能
    #define USART_BASIC_FEATURES
#endif</code></pre>
                        </div>
                        
                        <h3>故障排除与调试技巧</h3>
                        <p>常见USART问题及解决方法：</p>
                        <ul>
                            <li><strong>无通信/无数据</strong>：检查TX/RX引脚连接、波特率设置、时钟配置、电源是否正常</li>
                            <li><strong>数据错误/乱码</strong>：检查波特率精度、电磁干扰、地线连接、参数设置一致性</li>
                            <li><strong>中断不触发</strong>：确认中断使能、检查NVIC优先级、验证触发条件、检查中断服务函数</li>
                            <li><strong>丢失数据</strong>：启用硬件流控制、增加缓冲区、降低波特率、使用DMA传输</li>
                            <li><strong>DMA传输问题</strong>：检查DMA通道配置、传输完成标志、缓冲区对齐、内存管理</li>
                        </ul>
                    </div>
                    
                    <!-- 模块特性卡片展示 -->
                    <div class="content-section">
                        <h2><i class="fas fa-star"></i> 模块核心特性</h2>
                        <div class="module-features">
                            <div class="feature-card">
                                <h4><i class="fas fa-exchange-alt"></i> 全双工通信</h4>
                                <p>支持同时发送和接收数据，通信效率高，适用于实时双向数据交换场景。</p>
                            </div>
                            <div class="feature-card">
                                <h4><i class="fas fa-sliders-h"></i> 高度可配置</h4>
                                <p>支持多种数据格式、波特率、工作模式，可根据应用需求灵活调整配置参数。</p>
                            </div>
                            <div class="feature-card">
                                <h4><i class="fas fa-tachometer-alt"></i> 高性能传输</h4>
                                <p>最高支持4.5Mbps波特率，配合DMA传输，实现高效数据通信，减轻CPU负担。</p>
                            </div>
                            <div class="feature-card">
                                <h4><i class="fas fa-bolt"></i> 多种工作模式</h4>
                                <p>支持异步、同步、LIN、智能卡、IrDA等多种模式，应用范围广泛。</p>
                            </div>
                        </div>
                    </div>
                    
                    <a href="demo.html" class="back-button">
                        <i class="fas fa-arrow-left"></i> 返回主页面
                    </a>
                </div>
                
                <!-- 右侧侧边栏 - 模块详情 -->
                <div class="sidebar-right">
                    <div class="sidebar-section">
                        <h3><i class="fas fa-microchip"></i> 技术参数</h3>
                        <table class="params-table">
                            <thead>
                                <tr>
                                    <th>参数</th>
                                    <th>值/规格</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>工作电压</td>
                                    <td>2.0V - 3.6V</td>
                                </tr>
                                <tr>
                                    <td>最大波特率</td>
                                    <td>4.5 Mbps (72MHz下)</td>
                                </tr>
                                <tr>
                                    <td>数据位长度</td>
                                    <td>8 或 9 位</td>
                                </tr>
                                <tr>
                                    <td>停止位</td>
                                    <td>1, 1.5 或 2 位</td>
                                </tr>
                                <tr>
                                    <td>校验位</td>
                                    <td>奇校验、偶校验、无校验</td>
                                </tr>
                                <tr>
                                    <td>分数波特率</td>
                                    <td>支持，精度误差&lt;0.1%</td>
                                </tr>
                                <tr>
                                    <td>DMA支持</td>
                                    <td>发送和接收通道</td>
                                </tr>
                                <tr>
                                    <td>中断源</td>
                                    <td>发送完成、接收完成、错误中断</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3><i class="fas fa-list-alt"></i> 主要寄存器</h3>
                        <ul class="register-list">
                            <li>
                                <span class="register-name">USART_SR</span>
                                <span class="register-desc">状态寄存器，查询发送/接收状态和错误标志</span>
                            </li>
                            <li>
                                <span class="register-name">USART_DR</span>
                                <span class="register-desc">数据寄存器，存储发送/接收的数据</span>
                            </li>
                            <li>
                                <span class="register-name">USART_BRR</span>
                                <span class="register-desc">波特率寄存器，配置通信波特率</span>
                            </li>
                            <li>
                                <span class="register-name">USART_CR1</span>
                                <span class="register-desc">控制寄存器1，配置数据位、校验、使能等</span>
                            </li>
                            <li>
                                <span class="register-name">USART_CR2</span>
                                <span class="register-desc">控制寄存器2，配置停止位、时钟极性等</span>
                            </li>
                            <li>
                                <span class="register-name">USART_CR3</span>
                                <span class="register-desc">控制寄存器3，配置硬件流控制、DMA等</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3><i class="fas fa-plug"></i> 工作模式</h3>
                        <div class="pin-functions">
                            <span class="pin-tag">异步模式</span>
                            <span class="pin-tag">同步模式</span>
                            <span class="pin-tag">LIN模式</span>
                            <span class="pin-tag">智能卡模式</span>
                            <span class="pin-tag">IrDA模式</span>
                            <span class="pin-tag">轮询模式</span>
                            <span class="pin-tag">中断模式</span>
                            <span class="pin-tag">DMA模式</span>
                        </div>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3><i class="fas fa-exclamation-triangle"></i> 注意事项</h3>
                        <p style="color: #bbb; font-size: 0.95rem; line-height: 1.6; margin-top: 15px;">
                            <i class="fas fa-check-circle" style="color: #4CAF50; margin-right: 8px;"></i> 
                            确保TX和RX引脚正确配置为复用功能<br><br>
                            <i class="fas fa-check-circle" style="color: #4CAF50; margin-right: 8px;"></i> 
                            波特率设置需与通信双方一致，误差应小于2%<br><br>
                            <i class="fas fa-check-circle" style="color: #4CAF50; margin-right: 8px;"></i> 
                            长距离通信时建议启用奇偶校验和硬件流控制<br><br>
                            <i class="fas fa-check-circle" style="color: #4CAF50; margin-right: 8px;"></i> 
                            DMA传输时注意缓冲区边界和传输完成检测
                        </p>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3><i class="fas fa-history"></i> 典型应用场景</h3>
                        <p style="color: #bbb; font-size: 0.95rem; line-height: 1.6; margin-top: 15px;">
                            • 串口调试与日志输出<br>
                            • GPS/蓝牙/WiFi模块通信<br>
                            • 工业Modbus协议通信<br>
                            • 智能卡读卡器接口<br>
                            • 红外遥控器通信<br>
                            • 多机通信系统<br>
                            • 传感器数据采集
                        </p>
                    </div>
                </div>
            </div>
        </main>
        
        <footer>
            <p>STM32F103 USART模块详情页面 | 包含CubeMX配置、HAL库使用和技术参数</p>
            <p style="margin-top: 10px; font-size: 0.8rem;">提示：右上角按钮可快速跳转到CubeMX使用、HAL库使用和详细信息部分</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 页面加载动画
            document.body.style.opacity = 0;
            document.body.style.transition = 'opacity 0.8s ease';
            
            setTimeout(() => {
                document.body.style.opacity = 1;
            }, 100);
            
            // 为引脚标签添加悬停效果
            const pinTags = document.querySelectorAll('.pin-tag');
            pinTags.forEach(tag => {
                tag.addEventListener('mouseenter', function() {
                    this.style.boxShadow = '0 0 10px rgba(100, 100, 100, 0.5)';
                });
                
                tag.addEventListener('mouseleave', function() {
                    this.style.boxShadow = 'none';
                });
            });
            
            // 为表格行添加悬停效果
            const tableRows = document.querySelectorAll('.params-table tr, .config-table tr');
            tableRows.forEach(row => {
                row.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#2a2a2a';
                });
                
                row.addEventListener('mouseleave', function() {
                    if (this.rowIndex % 2 === 0) {
                        this.style.backgroundColor = '#1a1a1a';
                    } else {
                        this.style.backgroundColor = '';
                    }
                });
            });
            
            // 为返回按钮添加点击效果
            const backButton = document.querySelector('.back-button');
            if (backButton) {
                backButton.addEventListener('click', function(e) {
                    // 添加点击反馈
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 200);
                });
            }
            
            // 为导航按钮添加点击效果
            const navButtons = document.querySelectorAll('.nav-button');
            navButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // 添加点击反馈
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 200);
                });
            });
        });
        
        // 滚动到指定部分的函数
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                // 平滑滚动到目标位置
                element.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // 添加视觉反馈
                element.style.backgroundColor = '#2a2a2a';
                setTimeout(() => {
                    element.style.backgroundColor = '';
                }, 1500);
            }
        }
    </script>
</body>
</html>