<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STM32F103 - 外设模块详解</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background-color: #0a0a0a;
            color: #f0f0f0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* 头部样式 */
        header {
            padding: 30px 0 20px;
            border-bottom: 1px solid #333;
            margin-bottom: 40px;
        }
        
        /* 标题区域 - 改为左对齐 */
        h1 {
            color: #fff;
            font-size: 2.8rem;
            margin-bottom: 5px;
            letter-spacing: 1px;
            text-align: left;
        }
        
        /* 副标题与按钮容器 - 调整布局 */
        .subtitle-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .module-subtitle {
            color: #aaa;
            font-size: 1.2rem;
            line-height: 1.6;
            text-align: left;
            flex: 1;
            min-width: 300px;
            margin-bottom: 15px;
        }
        
        /* 面包屑导航 - 改为左对齐 */
        .breadcrumb {
            text-align: left;
            margin-bottom: 20px;
            color: #888;
            font-size: 0.95rem;
        }
        
        .breadcrumb a {
            color: #aaa;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .breadcrumb a:hover {
            color: #fff;
            text-decoration: underline;
        }
        
        /* 按钮容器 - 移到右侧 */
        .header-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }
        
        /* 导航按钮样式 */
        .nav-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background-color: #222;
            color: #fff;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            border: 1px solid #444;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .nav-button:hover {
            background-color: #333;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .nav-button.cubemx {
            border-left: 4px solid #ff9800;
        }
        
        .nav-button.hal {
            border-left: 4px solid #4ec9b0;
        }
        
        .nav-button.details {
            border-left: 4px solid #569cd6;
        }
        
        /* 主要内容布局 - 保持左主右辅 */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 40px;
            margin-bottom: 60px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.8s ease forwards;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* 左侧内容区域 */
        .content-left {
            background-color: #111;
            border-radius: 15px;
            padding: 40px;
            border: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        /* 右侧侧边栏 - 模块详情 */
        .sidebar-right {
            background-color: #111;
            border-radius: 15px;
            padding: 30px;
            border: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transform: translateX(30px);
            animation: slideInRight 1s ease 0.3s forwards;
        }
        
        @keyframes slideInRight {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* 内容区域样式 */
        .content-section {
            margin-bottom: 40px;
        }
        
        .content-section h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #fff;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .content-section h3 {
            font-size: 1.4rem;
            margin: 25px 0 15px;
            color: #ddd;
        }
        
        .content-section p {
            color: #bbb;
            line-height: 1.7;
            margin-bottom: 15px;
        }
        
        .content-section ul, .content-section ol {
            padding-left: 25px;
            margin-bottom: 20px;
        }
        
        .content-section li {
            color: #bbb;
            line-height: 1.7;
            margin-bottom: 8px;
        }
        
        /* 代码块样式 */
        .code-block {
            background-color: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #666;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        
        .code-block pre {
            color: #ddd;
            line-height: 1.5;
            white-space: pre-wrap;
        }
        
        .code-block code {
            color: #4ec9b0;
        }
        
        /* 外设导航卡片 */
        .peripheral-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .peripheral-card {
            background-color: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            border-top: 4px solid #666;
            transition: transform 0.3s ease, border-color 0.3s ease;
            cursor: pointer;
            text-align: left;
            border: 1px solid #333;
        }
        
        .peripheral-card:hover {
            transform: translateY(-5px);
            border-color: #4ec9b0;
            box-shadow: 0 5px 15px rgba(78, 201, 176, 0.1);
        }
        
        .peripheral-card h4 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .peripheral-card p {
            color: #bbb;
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .peripheral-tag {
            display: inline-block;
            background-color: #333;
            color: #ccc;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        /* 配置选项表格 */
        .config-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: #1a1a1a;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .config-table th {
            background-color: #222;
            color: #fff;
            text-align: left;
            padding: 12px 15px;
            font-weight: 600;
            border-bottom: 2px solid #333;
        }
        
        .config-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #333;
            color: #bbb;
        }
        
        .config-table tr:nth-child(even) {
            background-color: #1a1a1a;
        }
        
        .config-table tr:hover {
            background-color: #222;
        }
        
        /* 侧边栏样式 - 模块详情 */
        .sidebar-section {
            margin-bottom: 30px;
        }
        
        .sidebar-section h3 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #fff;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* 技术参数表格 */
        .params-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .params-table th {
            background-color: #222;
            color: #fff;
            text-align: left;
            padding: 12px 15px;
            font-weight: 600;
            border-bottom: 2px solid #333;
        }
        
        .params-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #333;
            color: #bbb;
        }
        
        .params-table tr:nth-child(even) {
            background-color: #1a1a1a;
        }
        
        .params-table tr:hover {
            background-color: #222;
        }
        
        /* 寄存器列表 */
        .register-list {
            list-style: none;
            padding: 0;
        }
        
        .register-list li {
            padding: 10px 15px;
            margin-bottom: 8px;
            background-color: #1a1a1a;
            border-radius: 6px;
            border-left: 3px solid #666;
            transition: all 0.3s ease;
        }
        
        .register-list li:hover {
            background-color: #222;
            border-left-color: #aaa;
            transform: translateX(5px);
        }
        
        .register-name {
            font-weight: bold;
            color: #fff;
            display: block;
            margin-bottom: 5px;
        }
        
        .register-desc {
            color: #aaa;
            font-size: 0.9rem;
        }
        
        /* 引脚功能标签 */
        .pin-functions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .pin-tag {
            background-color: #1a1a1a;
            color: #ccc;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid #333;
            transition: all 0.3s ease;
        }
        
        .pin-tag:hover {
            background-color: #222;
            border-color: #666;
            transform: translateY(-3px);
        }
        
        /* 模块特性卡片 */
        .module-features {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feature-card {
            background-color: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            border-top: 4px solid #666;
            transition: transform 0.3s ease, border-color 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            border-color: #aaa;
        }
        
        .feature-card h4 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .feature-card p {
            color: #bbb;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* 返回按钮 */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background-color: #222;
            color: #fff;
            text-decoration: none;
            padding: 12px 25px;
            border-radius: 8px;
            margin-top: 20px;
            transition: all 0.3s ease;
            border: 1px solid #444;
        }
        
        .back-button:hover {
            background-color: #333;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* 页脚 */
        footer {
            text-align: center;
            padding: 40px 0;
            margin-top: 60px;
            border-top: 1px solid #333;
            color: #888;
            font-size: 0.9rem;
        }
        
        /* 响应式设计 */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr 300px;
            }
            
            .content-left {
                padding: 30px;
            }
            
            .sidebar-right {
                padding: 25px;
            }
            
            .peripheral-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .sidebar-right {
                order: -1;
            }
            
            .peripheral-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .module-subtitle {
                font-size: 1rem;
                min-width: 100%;
            }
            
            .content-left, .sidebar-right {
                padding: 25px;
            }
            
            .module-features {
                grid-template-columns: 1fr;
            }
            
            .params-table, .config-table {
                font-size: 0.9rem;
            }
            
            .params-table th, .params-table td,
            .config-table th, .config-table td {
                padding: 10px 12px;
            }
            
            .subtitle-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .module-subtitle {
                text-align: left;
                width: 100%;
                order: 1;
            }
            
            .header-buttons {
                width: 100%;
                justify-content: flex-start;
                order: 2;
            }
            
            .breadcrumb {
                text-align: left;
            }
        }
        
        @media (max-width: 576px) {
            .content-left, .sidebar-right {
                padding: 20px;
            }
            
            .content-section h2 {
                font-size: 1.6rem;
            }
            
            .content-section h3 {
                font-size: 1.3rem;
            }
            
            .sidebar-section h3 {
                font-size: 1.3rem;
            }
            
            .header-buttons {
                flex-direction: column;
                width: 100%;
            }
            
            .nav-button {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* 新增：HAL函数卡片 */
        .hal-function-card {
            background-color: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 3px solid #4ec9b0;
            transition: all 0.3s ease;
        }
        
        .hal-function-card:hover {
            background-color: #222;
            transform: translateX(5px);
        }
        
        .function-name {
            color: #4ec9b0;
            font-family: 'Consolas', monospace;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .function-desc {
            color: #aaa;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        /* 新增：外设分类标签 */
        .peripheral-category {
            display: inline-block;
            background: linear-gradient(90deg, #333, #444);
            color: #fff;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin: 5px 5px 5px 0;
            border: 1px solid #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="breadcrumb">
                <a href="demo.html">主页</a> &gt; <span>其它外设模块</span>
            </div>
            
            <h1>其它外设模块</h1>
            
            <!-- 副标题与按钮容器 -->
            <div class="subtitle-container">
                <!-- 副标题 - 左侧 -->
                <p class="module-subtitle">STM32F103系列微控制器集成了丰富的外设模块，包括CRC、电源控制(PWR)、实时时钟(RTC)、CAN总线、USB接口等。</p>
                
                <!-- 新增的按钮容器 - 右侧 -->
                <div class="header-buttons">
                    <button class="nav-button cubemx" onclick="scrollToSection('cubemx-quickstart')">
                        <i class="fas fa-tools"></i> CubeMX使用
                    </button>
                    <button class="nav-button hal" onclick="scrollToSection('hal-library')">
                        <i class="fas fa-code"></i> HAL库使用
                    </button>
                    <button class="nav-button details" onclick="scrollToSection('details')">
                        <i class="fas fa-info-circle"></i> 详细信息
                    </button>
                </div>
            </div>
        </header>
        
        <main>
            <div class="main-content">
                <!-- 左侧内容区域 -->
                <div class="content-left">
                    <!-- 外设导航区域 -->
                    <div class="content-section">
                        <h2><i class="fas fa-microchip"></i> 外设模块导航</h2>
                        <p>点击以下卡片查看对应外设模块的详细信息：</p>
                        
                        <div class="peripheral-grid">
                            <div class="peripheral-card" onclick="showPeripheralInfo('crc')">
                                <h4><i class="fas fa-check-circle"></i> CRC计算单元</h4>
                                <p>硬件循环冗余校验单元，支持CRC-32多项式，用于数据完整性校验。</p>
                                <span class="peripheral-tag">数据校验</span>
                                <span class="peripheral-tag">硬件加速</span>
                            </div>
                            
                            <div class="peripheral-card" onclick="showPeripheralInfo('pwr')">
                                <h4><i class="fas fa-battery-half"></i> 电源控制(PWR)</h4>
                                <p>低功耗管理模块，支持睡眠、停止、待机模式，具有可编程电压监测器(PVD)。</p>
                                <span class="peripheral-tag">低功耗</span>
                                <span class="peripheral-tag">电源管理</span>
                            </div>
                            
                            <div class="peripheral-card" onclick="showPeripheralInfo('rtc')">
                                <h4><i class="fas fa-clock"></i> 实时时钟(RTC)</h4>
                                <p>提供日历、闹钟、时间戳功能，可由VBAT供电维持时间信息。</p>
                                <span class="peripheral-tag">实时时钟</span>
                                <span class="peripheral-tag">低功耗</span>
                            </div>
                            
                            <div class="peripheral-card" onclick="showPeripheralInfo('can')">
                                <h4><i class="fas fa-network-wired"></i> CAN总线</h4>
                                <p>控制器局域网接口，支持CAN 2.0B协议，适用于汽车和工业网络。</p>
                                <span class="peripheral-tag">工业通信</span>
                                <span class="peripheral-tag">高可靠性</span>
                            </div>
                            
                            <div class="peripheral-card" onclick="showPeripheralInfo('usb')">
                                <h4><i class="fas fa-usb"></i> USB接口</h4>
                                <p>全速USB设备接口，支持控制、中断、批量传输。</p>
                                <span class="peripheral-tag">USB 2.0</span>
                                <span class="peripheral-tag">数据传输</span>
                            </div>
                            
                            <div class="peripheral-card" onclick="showPeripheralInfo('spi')">
                                <h4><i class="fas fa-exchange-alt"></i> SPI/I2S接口</h4>
                                <p>高速串行外设接口，支持全双工通信和音频传输(I2S)。</p>
                                <span class="peripheral-tag">高速通信</span>
                                <span class="peripheral-tag">音频接口</span>
                            </div>
                            
                            <div class="peripheral-card" onclick="showPeripheralInfo('wdg')">
                                <h4><i class="fas fa-shield-alt"></i> 看门狗</h4>
                                <p>独立看门狗(IWDG)和窗口看门狗(WWDG)，用于系统监控与复位保护。</p>
                                <span class="peripheral-tag">系统保护</span>
                                <span class="peripheral-tag">故障恢复</span>
                            </div>
                            
                            <div class="peripheral-card" onclick="showPeripheralInfo('flash')">
                                <h4><i class="fas fa-database"></i> 闪存控制</h4>
                                <p>内部Flash存储器读写控制，支持预取缓冲和写保护功能。</p>
                                <span class="peripheral-tag">存储器</span>
                                <span class="peripheral-tag">固件存储</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="content-section">
                        <h2><i class="fas fa-info-circle"></i> 概述</h2>
                        <p>STM32F103系列基于ARM Cortex-M3内核，除了基本的GPIO、定时器、ADC等外设外，还集成了多种高级外设模块，满足不同应用场景的需求。这些外设模块在工业控制、汽车电子、消费电子等领域有着广泛的应用。</p>
                        
                        <h3>主要特性</h3>
                        <ul>
                            <li><strong>硬件CRC单元</strong>：提供高速数据完整性校验，减轻CPU负担</li>
                            <li><strong>多种低功耗模式</strong>：睡眠、停止、待机模式，满足电池供电应用</li>
                            <li><strong>RTC实时时钟</strong>：独立供电域，断电保持时间和日期</li>
                            <li><strong>CAN总线接口</strong>：符合CAN 2.0B标准，适用于工业控制网络</li>
                            <li><strong>USB全速接口</strong>：支持设备模式，便于与PC通信</li>
                            <li><strong>SPI/I2S接口</strong>：高速同步串行通信，支持音频数据传输</li>
                            <li><strong>看门狗定时器</strong>：独立和窗口看门狗，提高系统可靠性</li>
                            <li><strong>灵活的存储器接口</strong>：支持外扩NOR、NAND、SRAM等存储器</li>
                        </ul>
                        
                        <h3>应用领域</h3>
                        <p>STM32F103的外设模块使其广泛应用于以下领域：</p>
                        
                        <div class="peripheral-grid">
                            <div class="feature-card">
                                <h4><i class="fas fa-industry"></i> 工业控制</h4>
                                <p>CAN总线、高精度定时器、看门狗等外设适合工业自动化控制</p>
                            </div>
                            <div class="feature-card">
                                <h4><i class="fas fa-car"></i> 汽车电子</h4>
                                <p>CAN接口、宽温工作范围、高可靠性设计</p>
                            </div>
                            <div class="feature-card">
                                <h4><i class="fas fa-home"></i> 智能家居</h4>
                                <p>USB、SPI、I2C等接口连接各种传感器和执行器</p>
                            </div>
                            <div class="feature-card">
                                <h4><i class="fas fa-heartbeat"></i> 医疗设备</h4>
                                <p>RTC时间戳、数据完整性校验、低功耗模式</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 新增：CubeMX使用部分 -->
                    <div id="cubemx-quickstart" class="content-section">
                        <h2><i class="fas fa-tools"></i> CubeMX使用</h2>
                        <p>STM32CubeMX是ST官方提供的图形化配置工具，可以快速配置外设模块参数，生成初始化代码。</p>
                        
                        <h3>外设模块分配与配置</h3>
                        <p>在CubeMX中配置外设模块的基本步骤：</p>
                        <ul>
                            <li><strong>分配模块</strong>：在Pinout & Configuration页面，将相关引脚设为外设功能</li>
                            <li><strong>配置模块参数</strong>：在Configuration中配置详细参数，如时钟、模式、中断等</li>
                            <li><strong>生成代码</strong>：生成初始化代码和HAL库函数调用</li>
                        </ul>
                        
                        <h3>典型外设在CubeMX中的配置选项</h3>
                        <p>在CubeMX中配置外设模块时，常见的配置选项：</p>
                        
                        <table class="config-table">
                            <thead>
                                <tr>
                                    <th>外设</th>
                                    <th>主要配置项</th>
                                    <th>常用选项</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>CRC</td>
                                    <td>多项式选择、输入数据格式</td>
                                    <td>CRC-32<br>CRC-16<br>输入数据格式</td>
                                </tr>
                                <tr>
                                    <td>PWR</td>
                                    <td>低功耗模式、电压监测</td>
                                    <td>睡眠/停止/待机模式<br>PVD电压阈值</td>
                                </tr>
                                <tr>
                                    <td>RTC</td>
                                    <td>时钟源、时间格式、闹钟</td>
                                    <td>LSE/LSI时钟源<br>12/24小时格式<br>闹钟使能</td>
                                </tr>
                                <tr>
                                    <td>CAN</td>
                                    <td>工作模式、波特率、过滤器</td>
                                    <td>正常/环回/静默模式<br>波特率设置<br>过滤器配置</td>
                                </tr>
                                <tr>
                                    <td>USB</td>
                                    <td>设备类型、端点配置</td>
                                    <td>设备/主机模式<br>端点数量配置</td>
                                </tr>
                                <tr>
                                    <td>SPI/I2S</td>
                                    <td>工作模式、时钟极性、数据格式</td>
                                    <td>主/从模式<br>CPOL/CPHA设置<br>8/16位数据格式</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <h3>使用CubeMX配置USB设备的示例</h3>
                        <p>以下是使用CubeMX配置USB设备接口的示例步骤：</p>
                        
                        <div class="code-block">
                            <pre><code>// CubeMX生成的USB初始化代码（main.c中的MX_USB_DEVICE_Init函数）
// 1. 在CubeMX中配置USB为Device模式
// 2. 配置USB时钟源（需要48MHz时钟）
// 3. 配置端点数量和类型

static void MX_USB_DEVICE_Init(void) {
    // CubeMX自动生成的USB初始化代码
    // 使能USB时钟
    __HAL_RCC_USB_CLK_ENABLE();
    
    // 配置USB中断
    HAL_NVIC_SetPriority(USB_LP_CAN1_RX0_IRQn, 0, 0);
    HAL_NVIC_EnableIRQ(USB_LP_CAN1_RX0_IRQn);
    
    // 初始化USB设备库
    USBD_Init(&hUsbDeviceFS, &FS_Desc, DEVICE_FS);
    
    // 添加设备类
    USBD_RegisterClass(&hUsbDeviceFS, &USBD_CDC);
    
    // 添加CDC接口类
    USBD_CDC_RegisterInterface(&hUsbDeviceFS, &USBD_Interface_fops_FS);
    
    // 启动USB设备
    USBD_Start(&hUsbDeviceFS);
}</code></pre>
                        </div>
                        
                        <h3>使用CubeMX配置RTC的示例</h3>
                        <p>RTC配置涉及时钟源选择和备份域配置：</p>
                        
                        <div class="code-block">
                            <pre><code>// CubeMX生成的RTC初始化代码
static void MX_RTC_Init(void) {
    RTC_TimeTypeDef sTime = {0};
    RTC_DateTypeDef sDate = {0};
    
    // 配置RTC时钟源（LSE或LSI）
    RCC_OscInitTypeDef RCC_OscInitStruct = {0};
    RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_LSE;
    RCC_OscInitStruct.LSEState = RCC_LSE_ON;
    HAL_RCC_OscConfig(&RCC_OscInitStruct);
    
    // 配置RTC时钟
    RCC_PeriphCLKInitTypeDef PeriphClkInit = {0};
    PeriphClkInit.PeriphClockSelection = RCC_PERIPHCLK_RTC;
    PeriphClkInit.RTCClockSelection = RCC_RTCCLKSOURCE_LSE;
    HAL_RCCEx_PeriphCLKConfig(&PeriphClkInit);
    
    // 初始化RTC
    hrtc.Instance = RTC;
    hrtc.Init.AsynchPrediv = RTC_AUTO_1_SECOND;
    hrtc.Init.OutPut = RTC_OUTPUTSOURCE_ALARM;
    HAL_RTC_Init(&hrtc);
    
    // 设置初始时间
    sTime.Hours = 12;
    sTime.Minutes = 0;
    sTime.Seconds = 0;
    sTime.TimeFormat = RTC_HOURFORMAT12_AM;
    HAL_RTC_SetTime(&hrtc, &sTime, RTC_FORMAT_BIN);
}</code></pre>
                        </div>
                        
                        <h3>使用CubeMX配置的优势</h3>
                        <ul>
                            <li><strong>可视化配置</strong>：图形界面直观，避免寄存器配置错误</li>
                            <li><strong>代码自动生成</strong>：自动生成初始化代码和HAL库函数调用</li>
                            <li><strong>引脚冲突检测</strong>：自动检测引脚功能冲突并提示</li>
                            <li><strong>时钟树配置</strong>：图形化配置系统时钟和外设时钟</li>
                            <li><strong>项目管理</strong>：支持生成多种IDE工程文件（Keil、IAR、Eclipse等）</li>
                        </ul>
                    </div>
                    
                    <!-- HAL库使用部分 -->
                    <div id="hal-library" class="content-section">
                        <h2><i class="fas fa-code"></i> HAL库使用</h2>
                        <p>STM32Cube HAL库为所有外设提供了统一的API接口，简化了外设的配置和使用。</p>
                        
                        <h3>CRC计算单元</h3>
                        <p>硬件CRC单元可用于数据完整性校验，支持多种多项式。</p>
                        
                        <div class="hal-function-card">
                            <div class="function-name">HAL_CRC_Calculate()</div>
                            <div class="function-desc">计算给定数据的CRC值，支持CRC-32/16/8等多项式。</div>
                        </div>
                        
                        <div class="hal-function-card">
                            <div class="function-name">HAL_CRC_Accumulate()</div>
                            <div class="function-desc">累积计算CRC值，适用于分段数据处理。</div>
                        </div>
                        
                        <div class="code-block">
                            <pre><code>// CRC计算示例
#include "stm32f1xx_hal.h"

CRC_HandleTypeDef hcrc;

void CRC_Init(void) {
    __HAL_RCC_CRC_CLK_ENABLE();
    
    hcrc.Instance = CRC;
    hcrc.InputDataFormat = CRC_INPUTDATA_FORMAT_BYTES;
    
    HAL_CRC_Init(&hcrc);
}

uint32_t Calculate_CRC(uint32_t *data, uint32_t size) {
    // 计算数据的CRC值
    uint32_t crc = HAL_CRC_Calculate(&hcrc, data, size);
    return crc;
}</code></pre>
                        </div>
                        
                        <h3>电源控制(PWR)</h3>
                        <p>电源控制模块用于管理系统的低功耗模式。</p>
                        
                        <div class="hal-function-card">
                            <div class="function-name">HAL_PWR_EnterSLEEPMode()</div>
                            <div class="function-desc">进入睡眠模式，CPU停止运行，外设保持工作。</div>
                        </div>
                        
                        <div class="hal-function-card">
                            <div class="function-name">HAL_PWR_EnterSTOPMode()</div>
                            <div class="function-desc">进入停止模式，CPU和大部分外设停止，保留RAM内容。</div>
                        </div>
                        
                        <div class="hal-function-card">
                            <div class="function-name">HAL_PWR_EnterSTANDBYMode()</div>
                            <div class="function-desc">进入待机模式，最低功耗，系统复位唤醒。</div>
                        </div>
                        
                        <h3>实时时钟(RTC)</h3>
                        <p>RTC模块提供日历、闹钟和自动唤醒功能。</p>
                        
                        <div class="code-block">
                            <pre><code>// RTC初始化和设置示例
RTC_HandleTypeDef hrtc;

void RTC_Init(void) {
    __HAL_RCC_RTC_ENABLE();
    
    hrtc.Instance = RTC;
    hrtc.Init.AsynchPrediv = RTC_AUTO_1_SECOND;
    hrtc.Init.OutPut = RTC_OUTPUTSOURCE_ALARM;
    
    HAL_RTC_Init(&hrtc);
}

void Set_RTC_Time(uint8_t hour, uint8_t min, uint8_t sec) {
    RTC_TimeTypeDef sTime = {0};
    
    sTime.Hours = hour;
    sTime.Minutes = min;
    sTime.Seconds = sec;
    sTime.TimeFormat = RTC_HOURFORMAT12_AM;
    sTime.DayLightSaving = RTC_DAYLIGHTSAVING_NONE;
    sTime.StoreOperation = RTC_STOREOPERATION_RESET;
    
    HAL_RTC_SetTime(&hrtc, &sTime, RTC_FORMAT_BIN);
}</code></pre>
                        </div>
                        
                        <h3>CAN总线</h3>
                        <p>CAN总线用于工业控制网络通信。</p>
                        
                        <div class="hal-function-card">
                            <div class="function-name">HAL_CAN_Init()</div>
                            <div class="function-desc">初始化CAN外设，配置波特率和过滤器。</div>
                        </div>
                        
                        <div class="hal-function-card">
                            <div class="function-name">HAL_CAN_Transmit()</div>
                            <div class="function-desc">发送CAN帧到总线。</div>
                        </div>
                        
                        <div class="hal-function-card">
                            <div class="function-name">HAL_CAN_Receive()</div>
                            <div class="function-desc">从CAN总线接收数据帧。</div>
                        </div>
                    </div>
                    
                    <div class="content-section">
                        <h2><i class="fas fa-cogs"></i> 配置与使用</h2>
                        <p>以下是主要外设模块的配置步骤和使用示例。</p>
                        
                        <h3>外设配置步骤</h3>
                        <ol>
                            <li><strong>时钟使能</strong>：通过RCC模块启用外设时钟</li>
                            <li><strong>初始化结构体</strong>：配置外设参数（模式、速度、中断等）</li>
                            <li><strong>调用初始化函数</strong>：使用HAL库初始化函数配置外设</li>
                            <li><strong>中断配置</strong>：如有需要，配置NVIC中断优先级</li>
                            <li><strong>功能使用</strong>：调用相应的HAL库函数使用外设功能</li>
                        </ol>
                        
                        <h3>SPI通信示例</h3>
                        <p>SPI接口可用于连接外部存储器、显示屏、传感器等设备。</p>
                        
                        <div class="code-block">
                            <pre><code>// SPI主模式通信示例
#include "stm32f1xx_hal.h"

SPI_HandleTypeDef hspi1;

void SPI_Init(void) {
    __HAL_RCC_SPI1_CLK_ENABLE();
    __HAL_RCC_GPIOA_CLK_ENABLE();
    
    // GPIO配置
    GPIO_InitTypeDef GPIO_InitStruct = {0};
    GPIO_InitStruct.Pin = GPIO_PIN_5 | GPIO_PIN_6 | GPIO_PIN_7;
    GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;
    GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_HIGH;
    HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);
    
    // SPI配置
    hspi1.Instance = SPI1;
    hspi1.Init.Mode = SPI_MODE_MASTER;
    hspi1.Init.Direction = SPI_DIRECTION_2LINES;
    hspi1.Init.DataSize = SPI_DATASIZE_8BIT;
    hspi1.Init.CLKPolarity = SPI_POLARITY_LOW;
    hspi1.Init.CLKPhase = SPI_PHASE_1EDGE;
    hspi1.Init.NSS = SPI_NSS_SOFT;
    hspi1.Init.BaudRatePrescaler = SPI_BAUDRATEPRESCALER_4;
    hspi1.Init.FirstBit = SPI_FIRSTBIT_MSB;
    hspi1.Init.TIMode = SPI_TIMODE_DISABLE;
    hspi1.Init.CRCCalculation = SPI_CRCCALCULATION_DISABLE;
    hspi1.Init.CRCPolynomial = 10;
    
    HAL_SPI_Init(&hspi1);
}

void SPI_Transmit(uint8_t *data, uint16_t size) {
    HAL_SPI_Transmit(&hspi1, data, size, HAL_MAX_DELAY);
}</code></pre>
                        </div>
                    </div>
                    
                    <!-- 详细信息部分 -->
                    <div id="details" class="content-section">
                        <h2><i class="fas fa-file-alt"></i> 详细信息</h2>
                        <p>深入介绍各外设模块的技术细节和工作原理。</p>
                        
                        <h3>电源控制架构</h3>
                        <p>STM32F103的电源管理系统包含多个电源域：</p>
                        <ul>
                            <li><strong>VDD域</strong>：主电源，为数字电路供电（2.0-3.6V）</li>
                            <li><strong>VDDA域</strong>：模拟电源，为ADC、DAC等供电</li>
                            <li><strong>VBAT域</strong>：备份电源，为RTC和备份寄存器供电</li>
                        </ul>
                        
                        <h3>RTC工作原理</h3>
                        <p>实时时钟模块由独立的低速时钟驱动（LSE或LSI），具有以下特性：</p>
                        <ul>
                            <li>日历功能：年、月、日、时、分、秒计数</li>
                            <li>闹钟功能：可设置多个闹钟中断</li>
                            <li>时间戳功能：记录外部事件发生时间</li>
                            <li>自动唤醒：定时从低功耗模式唤醒系统</li>
                        </ul>
                        
                        <h3>CAN总线架构</h3>
                        <p>bxCAN控制器采用先进的邮箱和过滤器机制：</p>
                        <div class="code-block">
                            <pre><code>// CAN过滤器配置示例
CAN_FilterTypeDef sFilterConfig;

void CAN_Filter_Config(void) {
    sFilterConfig.FilterBank = 0;
    sFilterConfig.FilterMode = CAN_FILTERMODE_IDMASK;
    sFilterConfig.FilterScale = CAN_FILTERSCALE_32BIT;
    sFilterConfig.FilterIdHigh = 0x0000;
    sFilterConfig.FilterIdLow = 0x0000;
    sFilterConfig.FilterMaskIdHigh = 0x0000;
    sFilterConfig.FilterMaskIdLow = 0x0000;
    sFilterConfig.FilterFIFOAssignment = CAN_RX_FIFO0;
    sFilterConfig.FilterActivation = ENABLE;
    sFilterConfig.SlaveStartFilterBank = 14;
    
    HAL_CAN_ConfigFilter(&hcan, &sFilterConfig);
}</code></pre>
                        </div>
                        
                        <h3>闪存存储器管理</h3>
                        <p>内部Flash具有以下特性：</p>
                        <ul>
                            <li>存储容量：64KB-512KB（不同型号）</li>
                            <li>页大小：1KB或2KB</li>
                            <li>擦除操作：可按页或全片擦除</li>
                            <li>写保护：可设置读写保护，防止意外修改</li>
                            <li>预取缓冲：提高指令读取效率</li>
                        </ul>
                        
                        <h3>故障排除指南</h3>
                        <p>常见问题及解决方法：</p>
                        <p><strong>问题1：RTC时间不准确</strong><br>
                        解决方法：检查LSE晶振是否正常起振，校准RTC时钟源。</p>
                        
                        <p><strong>问题2：CAN通信失败</strong><br>
                        解决方法：检查终端电阻、波特率设置和过滤器配置。</p>
                        
                        <p><strong>问题3：进入低功耗模式后无法唤醒</strong><br>
                        解决方法：检查唤醒源配置和中断优先级设置。</p>
                    </div>
                    
                    <!-- 模块特性卡片展示 -->
                    <div class="content-section">
                        <h2><i class="fas fa-star"></i> 模块特性</h2>
                        <div class="module-features">
                            <div class="feature-card">
                                <h4><i class="fas fa-bolt"></i> 高性能</h4>
                                <p>72MHz Cortex-M3内核，硬件CRC加速，SPI通信速度高达18Mbps。</p>
                            </div>
                            <div class="feature-card">
                                <h4><i class="fas fa-tachometer-alt"></i> 低功耗</h4>
                                <p>多种低功耗模式，待机模式电流低至2μA，适合电池供电应用。</p>
                            </div>
                            <div class="feature-card">
                                <h4><i class="fas fa-cog"></i> 高集成度</h4>
                                <p>单芯片集成丰富外设，减少外部元件，降低系统成本和尺寸。</p>
                            </div>
                            <div class="feature-card">
                                <h4><i class="fas fa-shield-alt"></i> 高可靠性</h4>
                                <p>独立/窗口看门狗、PVD电源监测、CRC校验等多重保护机制。</p>
                            </div>
                        </div>
                    </div>
                    
                    <a href="demo.html" class="back-button">
                        <i class="fas fa-arrow-left"></i> 返回主页面
                    </a>
                </div>
                
                <!-- 右侧侧边栏 - 模块详情 -->
                <div class="sidebar-right">
                    <div class="sidebar-section">
                        <h3><i class="fas fa-microchip"></i> 技术参数</h3>
                        <table class="params-table">
                            <thead>
                                <tr>
                                    <th>参数</th>
                                    <th>值/规格</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>内核</td>
                                    <td>ARM Cortex-M3 72MHz</td>
                                </tr>
                                <tr>
                                    <td>工作电压</td>
                                    <td>2.0V - 3.6V</td>
                                </tr>
                                <tr>
                                    <td>CRC计算单元</td>
                                    <td>CRC-32/16/8硬件计算</td>
                                </tr>
                                <tr>
                                    <td>RTC时钟源</td>
                                    <td>LSE(32.768kHz)/LSI(40kHz)</td>
                                </tr>
                                <tr>
                                    <td>CAN总线</td>
                                    <td>CAN 2.0B, 1Mbps最大速率</td>
                                </tr>
                                <tr>
                                    <td>USB接口</td>
                                    <td>USB 2.0全速设备</td>
                                </tr>
                                <tr>
                                    <td>SPI接口</td>
                                    <td>最高18Mbps，主从模式</td>
                                </tr>
                                <tr>
                                    <td>低功耗模式</td>
                                    <td>睡眠、停止、待机</td>
                                </tr>
                                <tr>
                                    <td>待机电流</td>
                                    <td>&lt; 2μA (典型值)</td>
                                </tr>
                                <tr>
                                    <td>工作温度</td>
                                    <td>-40°C 到 +85°C</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3><i class="fas fa-list-alt"></i> 主要外设分类</h3>
                        <div style="margin-top: 15px;">
                            <span class="peripheral-category">通信接口</span>
                            <span class="peripheral-category">电源管理</span>
                            <span class="peripheral-category">数据校验</span>
                            <span class="peripheral-category">时间管理</span>
                            <span class="peripheral-category">系统保护</span>
                            <span class="peripheral-category">存储器</span>
                            <span class="peripheral-category">调试支持</span>
                        </div>
                        
                        <ul class="register-list" style="margin-top: 20px;">
                            <li>
                                <span class="register-name">CRC_DR - 数据寄存器</span>
                                <span class="register-desc">存储CRC计算输入/输出数据</span>
                            </li>
                            <li>
                                <span class="register-name">PWR_CR - 电源控制寄存器</span>
                                <span class="register-desc">配置低功耗模式和电压监测</span>
                            </li>
                            <li>
                                <span class="register-name">RTC_TR - 时间寄存器</span>
                                <span class="register-desc">存储时、分、秒信息</span>
                            </li>
                            <li>
                                <span class="register-name">CAN_TIxR - 发送标识符寄存器</span>
                                <span class="register-desc">CAN发送邮箱标识符</span>
                            </li>
                            <li>
                                <span class="register-name">USB_EPnR - 端点寄存器</span>
                                <span class="register-desc">USB端点配置和状态</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3><i class="fas fa-plug"></i> 典型接口引脚</h3>
                        <div class="pin-functions">
                            <span class="pin-tag">CAN_TX (发送)</span>
                            <span class="pin-tag">CAN_RX (接收)</span>
                            <span class="pin-tag">USB_DP (数据+)</span>
                            <span class="pin-tag">USB_DM (数据-)</span>
                            <span class="pin-tag">SPI_SCK (时钟)</span>
                            <span class="pin-tag">SPI_MISO (主入从出)</span>
                            <span class="pin-tag">SPI_MOSI (主出从入)</span>
                            <span class="pin-tag">RTC_OUT (时钟输出)</span>
                            <span class="pin-tag">VBAT (备份电源)</span>
                        </div>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3><i class="fas fa-exclamation-triangle"></i> 注意事项</h3>
                        <p style="color: #bbb; font-size: 0.95rem; line-height: 1.6; margin-top: 15px;">
                            <i class="fas fa-check-circle" style="color: #4CAF50; margin-right: 8px;"></i> 
                            RTC使用前需配置备份域写保护解除<br><br>
                            <i class="fas fa-check-circle" style="color: #4CAF50; margin-right: 8px;"></i> 
                            CAN通信需正确配置终端电阻(120Ω)<br><br>
                            <i class="fas fa-check-circle" style="color: #4CAF50; margin-right: 8px;"></i> 
                            USB接口需要外部上拉电阻标识设备速度<br><br>
                            <i class="fas fa-check-circle" style="color: #4CAF50; margin-right: 8px;"></i> 
                            低功耗模式下部分外设时钟会被关闭
                        </p>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3><i class="fas fa-history"></i> 典型应用场景</h3>
                        <p style="color: #bbb; font-size: 0.95rem; line-height: 1.6; margin-top: 15px;">
                            • 工业自动化控制<br>
                            • 汽车电子系统<br>
                            • 智能家居设备<br>
                            • 医疗监测仪器<br>
                            • 消费电子产品<br>
                            • 通信网络设备<br>
                            • 电源管理系统
                        </p>
                    </div>
                </div>
            </div>
        </main>
        
        <footer>
            <p>STM32F103 外设模块详解 | 左侧内容展示，右侧侧边栏展示技术参数和详细信息</p>
            <p style="margin-top: 10px; font-size: 0.8rem;">提示：点击上方导航按钮可快速跳转到CubeMX使用、HAL库使用或详细信息部分</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 页面加载动画
            document.body.style.opacity = 0;
            document.body.style.transition = 'opacity 0.8s ease';
            
            setTimeout(() => {
                document.body.style.opacity = 1;
            }, 100);
            
            // 为引脚标签添加悬停效果
            const pinTags = document.querySelectorAll('.pin-tag');
            pinTags.forEach(tag => {
                tag.addEventListener('mouseenter', function() {
                    this.style.boxShadow = '0 0 10px rgba(100, 100, 100, 0.5)';
                });
                
                tag.addEventListener('mouseleave', function() {
                    this.style.boxShadow = 'none';
                });
            });
            
            // 为表格行添加悬停效果
            const tableRows = document.querySelectorAll('.params-table tr, .config-table tr');
            tableRows.forEach(row => {
                row.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#2a2a2a';
                });
                
                row.addEventListener('mouseleave', function() {
                    if (this.rowIndex % 2 === 0) {
                        this.style.backgroundColor = '#1a1a1a';
                    } else {
                        this.style.backgroundColor = '';
                    }
                });
            });
            
            // 为返回按钮添加点击效果
            const backButton = document.querySelector('.back-button');
            if (backButton) {
                backButton.addEventListener('click', function(e) {
                    // 添加点击反馈
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 200);
                });
            }
            
            // 为导航按钮添加点击效果
            const navButtons = document.querySelectorAll('.nav-button');
            navButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // 添加点击反馈
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 200);
                });
            });
            
            // 为外设卡片添加点击效果
            const peripheralCards = document.querySelectorAll('.peripheral-card');
            peripheralCards.forEach(card => {
                card.addEventListener('click', function() {
                    // 添加点击反馈
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 200);
                });
            });
            
            // 为HAL函数卡片添加悬停效果
            const halCards = document.querySelectorAll('.hal-function-card');
            halCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.boxShadow = '0 5px 15px rgba(78, 201, 176, 0.2)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.boxShadow = 'none';
                });
            });
        });
        
        // 滚动到指定部分的函数
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                // 平滑滚动到目标位置
                element.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // 添加视觉反馈
                element.style.backgroundColor = '#2a2a2a';
                setTimeout(() => {
                    element.style.backgroundColor = '';
                }, 1500);
            }
        }
        
        // 显示外设详细信息函数
        function showPeripheralInfo(peripheral) {
            const peripheralInfo = {
                'crc': {
                    title: 'CRC计算单元',
                    content: '硬件循环冗余校验单元，支持CRC-32多项式。可用于验证数据传输或存储的完整性，也支持软件标识计算。'
                },
                'pwr': {
                    title: '电源控制(PWR)',
                    content: '支持多种低功耗模式：睡眠、停止、待机。具有可编程电压监测器(PVD)，可监控电源电压并触发中断。支持备份区域供电(VBAT)，用于维持RTC和备份寄存器。'
                },
                'rtc': {
                    title: '实时时钟(RTC)',
                    content: '提供日历、闹钟、唤醒功能。可由LSI、LSE或HSE分频提供时钟。支持自动唤醒单元(AWU)，用于低功耗模式定时唤醒。'
                },
                'can': {
                    title: 'CAN总线(bxCAN)',
                    content: '支持CAN 2.0B协议，具有发送邮箱和接收过滤器。支持静默、环回、环回静默等测试模式。'
                },
                'usb': {
                    title: 'USB全速设备接口',
                    content: '支持USB 2.0全速设备模式。具有端点缓冲区描述表，支持控制、中断、批量传输。'
                },
                'spi': {
                    title: 'SPI/I2S接口',
                    content: 'SPI支持全双工/半双工通信，主从模式。I2S支持音频协议(Philips、MSB、LSB、PCM)，可用于音频传输。'
                },
                'wdg': {
                    title: '看门狗定时器',
                    content: '独立看门狗(IWDG)基于LSI时钟，用于系统复位恢复。窗口看门狗(WWDG)基于APB1时钟，必须在设定时间窗口内刷新。'
                },
                'flash': {
                    title: '闪存存储器接口',
                    content: '支持读写、擦除操作，具有写保护功能。支持预取缓冲器，提高指令读取效率。提供启动配置选项：从主闪存、系统存储器或SRAM启动。'
                }
            };
            
            if (peripheralInfo[peripheral]) {
                alert(`${peripheralInfo[peripheral].title}\n\n${peripheralInfo[peripheral].content}`);
            }
        }
    </script>
</body>
</html>