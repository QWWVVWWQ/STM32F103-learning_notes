
STM32系统结构与外设
片上资源（外设）包括：
NVIC（嵌套向量中断控制器）
SysTick（系统滴答定时器）
GPIO（通用输入输出）
TIM（定时器）
USART（串口通信)
I2C、SPI、CAN、USB、ADC、DAC等

命名规则（以STM32F103C8T6为例）：
STM32：基于ARM的32位MCU
F：通用型
103：增强型
C：48引脚
8：64KB Flash
T：LQFP封装
6：工业级温度范围（-40°C ~ 85°C）

GPIO（通用输入输出）
GPIO工作模式
8种工作模式：
模式	性质	特征
浮空输入	数字输入	引脚悬空时电平不确定
上拉输入	数字输入	内部上拉电阻，悬空默认高电平
下拉输入	数字输入	内部下拉电阻，悬空默认低电平
模拟输入	模拟输入	引脚直接接入内部ADC
开漏输出	数字输出	高电平为高阻态，只有低电平有驱动能力
推挽输出	数字输出	高低电平均有驱动能力
复用开漏输出	数字输出	由片上外设控制，开漏特性
复用推挽输出	数字输出	由片上外设控制，推挽特性
 GPIO库函数详解
时钟使能函数
// 使能GPIOx时钟（GPIOA~G）
RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);

// 使能AFIO时钟（用于引脚重映射和外部中断配置）
RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO, ENABLE);
2.2.2 GPIO初始化函数
// GPIO初始化结构体
typedef struct {
    uint16_t GPIO_Pin;              // 引脚号：GPIO_Pin_0~15
    GPIOSpeed_TypeDef GPIO_Speed;   // 速度：GPIO_Speed_10/50MHz
    GPIOMode_TypeDef GPIO_Mode;     // 模式：8种模式之一
} GPIO_InitTypeDef;

// 初始化函数
void GPIO_Init(GPIO_TypeDef* GPIOx, GPIO_InitTypeDef* GPIO_InitStruct);

// 示例：初始化PA0为推挽输出，50MHz
GPIO_InitTypeDef GPIO_InitStructure;
GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0;
GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;
GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
GPIO_Init(GPIOA, &GPIO_InitStructure);
GPIO读写函数
// 设置引脚为高电平
void GPIO_SetBits(GPIO_TypeDef* GPIOx, uint16_t GPIO_Pin);
// 设置引脚为低电平
void GPIO_ResetBits(GPIO_TypeDef* GPIOx, uint16_t GPIO_Pin);
// 写入指定电平（Bit_SET/Bit_RESET）
void GPIO_WriteBit(GPIO_TypeDef* GPIOx, uint16_t GPIO_Pin, BitAction BitVal);

// 同时控制16个引脚
void GPIO_Write(GPIO_TypeDef* GPIOx, uint16_t PortVal);
// 读取输入引脚电平
uint8_t GPIO_ReadInputDataBit(GPIO_TypeDef* GPIOx, uint16_t GPIO_Pin);
// 读取输出引脚电平
uint8_t GPIO_ReadOutputDataBit(GPIO_TypeDef* GPIOx, uint16_t GPIO_Pin);
// 读取整个端口输入值
uint16_t GPIO_ReadInputData(GPIO_TypeDef* GPIOx);

// 读取整个端口输出值
uint16_t GPIO_ReadOutputData(GPIO_TypeDef* GPIOx);
GPIO（通用输入输出）
 GPIO简介
可配置为8种模式：4种输入、4种输出。
输入模式：浮空、上拉、下拉、模拟输入。
输出模式：推挽、开漏、复用推挽、复用开漏。

GPIO应用示例
 输出模式控制LED、蜂鸣器
推挽输出：高低电平均有驱动能力。
开漏输出：只有低电平有驱动能力。
代码示例：LED闪烁、流水灯、蜂鸣器控制。

输入模式读取按键、传感器
上拉/下拉输入用于读取电平信号。
按键消抖处理：延时检测。
传感器模块（如光敏传感器）读取数字信号。

外部中断（EXTI）与中断系统
中断系统简介
中断：CPU暂停当前程序，转去处理中断事件，完成后返回。
中断优先级：多个中断同时申请时，CPU按优先级响应。
中断嵌套：高优先级中断可打断低优先级中断。

NVIC（嵌套向量中断控制器）
管理所有中断通道，每个通道有16个可编程优先级。
优先级分组：抢占优先级 + 响应优先级。
抢占优先级高的可以中断嵌套
抢占优先级相同时，子优先级高的优先响应
都相同时，按中断号排队
分组方式：

分组	抢占优先级位数	响应优先级位数
0		0		4
1		1		3
2		2		2
3		3		1
4		4		0
EXTI（外部中断）
用于监测GPIO电平变化，触发中断。
支持触发方式：上升沿、下降沿、双边沿、软件触发。
相同Pin号的GPIO不能同时触发中断（如PA0、PB0、PC0不能同时用）。

EXTI应用示例
旋转编码器计次
通过检测A、B相方波信号，判断转动方向和速度。
使用外部中断下降沿触发，配合软件消抖。

对射式红外传感器计次
遮挡传感器时触发下降沿中断，计次累加。
常用EXTI/NVIC函数
// AFIO配置中断引脚选择
void GPIO_EXTILineConfig(uint8_t GPIO_PortSource, uint8_t GPIO_PinSource);
// EXTI初始化
void EXTI_Init(EXTI_InitTypeDef* EXTI_InitStruct);
// NVIC中断分组与初始化
void NVIC_PriorityGroupConfig(uint32_t NVIC_PriorityGroup);
void NVIC_Init(NVIC_InitTypeDef* NVIC_InitStruct);
4.6 中断服务函数（ISR）
函数名需与启动文件中定义一致（如EXTI0_IRQHandler）。
在ISR中检测中断标志位，并清除标志：

if (EXTI_GetITStatus(EXTI_Line0) == SET) {
    // 处理中断
    EXTI_ClearITPendingBit(EXTI_Line0);
}
五、中断应用代码结构示例（按键中断控制LED）
// 初始化按键GPIO为中断输入
GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU; // 上拉输入
GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0;
GPIO_Init(GPIOB, &GPIO_InitStructure);

// 配置EXTI线0（对应PB0）
GPIO_EXTILineConfig(GPIO_PortSourceGPIOB, GPIO_PinSource0);
EXTI_InitStructure.EXTI_Line = EXTI_Line0;
EXTI_InitStructure.EXTI_Mode = EXTI_Mode_Interrupt;
EXTI_InitStructure.EXTI_Trigger = EXTI_Trigger_Falling;
EXTI_InitStructure.EXTI_LineCmd = ENABLE;
EXTI_Init(&EXTI_InitStructure);

// 配置NVIC
NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);
NVIC_InitStructure.NVIC_IRQChannel = EXTI0_IRQn;
NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 1;
NVIC_InitStructure.NVIC_IRQChannelSubPriority = 1;
NVIC_Init(&NVIC_InitStructure);


